AWSTemplateFormatVersion: "2010-09-09"

Resources:
  ReadySetMySQLStack:
    Type: "AWS::CloudFormation::Stack"
    Properties:
      Parameters:
        # Change this between deployments. Have been using irl-deployment-YYYY-MM-DD-NN
        ReadySetDeploymentName: "<deployment name>"
        ConsulEc2RetryJoinTagKey: "ReadysetConsulNodeType"
        ConsulEc2RetryJoinTagValue: "Server"
        # From Consul stack output
        ConsulJoinManagedPolicyArn: "<ARN from consul stack>"
        DatabaseAdapterUsername: "readyset"
        DatabaseHostname: "prod-rds-meow-rr-4.c9tymodnghoe.us-east-1.rds.amazonaws.com"
        DatabaseName: "irl"
        DatabasePort: 3306
        DatabaseProtocol: "mysql"
        KeyPairName: "readyset"
        PrivateSubnet1ID: "subnet-02b0d5f328b759cd8"
        PrivateSubnet2ID: "subnet-00ddf8a64c29154a4"
        PrivateSubnet3ID: "subnet-0da46bb41d79196c2"
        ReadySetAdapterInstanceType: "c5.large"
        ReadySetAdapterNodes: 3
        # From VPC Supplemental output
        ReadySetAdapterSecurityGroupID: "sg-01c7cebcccdcfa574"
        ReadySetMemoryLimitGB: 25
        ReadySetServerAutoGrowVolume: "true"
        ReadySetServerInitialVolumeSizeGB: 2048
        ReadySetServerInstanceType: "c5.4xlarge"
        ReadySetServerMaxVolumeSizeGB: 4096
        ReadySetServerNodes: 3
        ReadySetLogLevel: "info,replicators=debug,noria_dataflow=debug"
        # From VPC Supplemental output
        ReadySetServerSecurityGroupID: "sg-0aab5125f13e99d24"
        SSMParameterKmsKeyArn: "arn:aws:kms:us-east-1:724964194832:key/27e63384-98ea-4827-aac9-8e5cacd6daf1"
        SSMPathRDSDatabasePassword: "/readyset/prod-rds-meow-readyset/password"
        VPCID: "vpc-0c6cb42c8c969381e"
        EnableCloudwatch: "true"
        EnableAggregation: "true"
      # Update this based upon release
      # Release names have been irl-deployment-YYYY-MM-DD-NN
      TemplateURL: "https://readysettech-cfn-public-us-east-2.s3.us-east-2.amazonaws.com/<release name>/readyset/templates/readyset-mysql-template.yaml"
