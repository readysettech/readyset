steps:
  {{#each root_modules}}
  - label: ":terraform: Plan for {{ path }}"
    plugins:
      - docker#v3.8.0:
          image: "305232526136.dkr.ecr.us-east-2.amazonaws.com/substrate-runtime:${BUILDKITE_COMMIT}"
          propagate-environment: true
          propagate-aws-auth-tokens: true
          command:
            - "buildkite-terraform-plan"
            - "{{ path }}"
          shell: false
          environment:
          - BUILDKITE_API_TOKEN
          - BUILDKITE_GERRIT_PASSWORD
      - ecr#v2.5.0:
          account_ids: "305232526136"
          login: true
          retries: 3
      - cultureamp/aws-assume-role#v0.2.0:
          role: "arn:aws:iam::716876017850:role/Administrator"
    agents:
      queue: ops
  {{/each}}
