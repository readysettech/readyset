# -- Service configuration block
service:
  type: ClusterIP
  port: 9091
  targetPort: 9091

# -- Replica count for push gateway pods
replicaCount: ${replicaCount}

# -- Security context to be added to push-gateway pods
securityContext:
  fsGroup: 65534
  runAsUser: 65534
  runAsNonRoot: true

# -- Security context to be added to push-gateway containers
# -- Having a separate variable as securityContext differs for pods and containers.
containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsUser: 65534
  runAsNonRoot: true

serviceMonitor:
  enabled: true
  namespace: ${service_mon_namespace}
  # Retain the job and instance labels of the metrics pushed to the Pushgateway
  # [Scraping Pushgateway](https://github.com/prometheus/pushgateway#configure-the-pushgateway-as-a-target-to-scrape)
  honorLabels: true

  ## Relabel configs to apply to samples before ingestion.
  ## [Relabeling](https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config)
  relabelings:
    - sourceLabels: [__meta_kubernetes_pod_node_name]
      separator: ;
      regex: ^(.*)$
      targetLabel: nodename
      replacement: $1
      action: replace

# Deployment Strategy type
strategy:
  type: ${deployment_strategy}

# Configuration for clusters with restrictive network policies in place:
# - allowAll allows access to the PushGateway from any namespace
# - customSelector is a list of pod/namespaceSelectors to allow access from
# These options are mutually exclusive and the latter will take precedence.
networkPolicy:
  allowAll: false
  customSelectors:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: ${namespace}
