AWSTemplateFormatVersion: "2010-09-09"

Description: Creates an IAM user for deploying ReadySet

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: Authentication Parameters
        Parameters:
          - InitialPassword

Parameters:
  InitialPassword:
    Description: Initial password for ReadySet user
    Type: String
    Default: R3adyS3t!
    MinLength: 8
    NoEcho: true
    ConstraintDescription: Must follow your IAM user password policy

Resources:
  ReadySetDeployPolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      Description: Policy for allowing ReadySet to deploy
      Path: /
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Action:
              - cloudformation:CreateStack
              - cloudformation:CreateChangeSet
              - cloudformation:DeleteStack
              - cloudformation:DeleteChangeSet
              - cloudformation:UpdateStack
            Resource: '*'

  ReadySetUser:
    Type: AWS::IAM::User
    Properties:
      LoginProfile:
        Password: !Ref InitialPassword
        PasswordResetRequired: true
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess
        - arn:aws:iam::aws:policy/IAMUserChangePassword
        - !Ref ReadySetDeployPolicy
