version: "3.8"
services:
  zookeeper:
    image: 305232526136.dkr.ecr.us-east-2.amazonaws.com/zookeeper
    healthcheck:
      test: ["CMD", "nc", "-vz", "localhost", "2181"]
      interval: 10s
      timeout: 2s
      retries: 5
      start_period: 5s
    ports:
      - '2181:2181'
  consul-server:
    image: consul
    restart: always
    volumes:
      - ./docker/consul/server.json:/consul/config/server.json:ro
    ports:
      - '8500:8500'
      - '8600:8600/tcp'
      - '8600:8600/udp'
    command: 'agent -bootstrap-expect=1'
  mysql:
    image: 305232526136.dkr.ecr.us-east-2.amazonaws.com/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=noria
      - MYSQL_DATABASE=noria
    ports:
      - '3306:3306'
  postgres:
    image: 305232526136.dkr.ecr.us-east-2.amazonaws.com/postgres
    environment:
      - POSTGRES_PASSWORD=noria
      - POSTGRES_DB=noria
    command:
      - "postgres"
      - "-c"
      - "wal_level=logical"
    ports:
      - '5432:5432'
  redis:
    image: 305232526136.dkr.ecr.us-east-2.amazonaws.com/redis:6.2
    ports:
      - '6379:6379'
