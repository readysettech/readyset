# This file contains common build steps that can be included in other pipeline contexts.

# Non-buildkite nodes to re-use:
common_values:
  retry: &retry_on_agent_kill
    automatic: &agent_kill_conditions
      - signal_reason: agent_stop  # spot instance killed by AWS
        limit: 3
      - exit_status: -1            # agent timed out
        signal_reason: none
        limit: 3
steps:

  - label: ':rust: Run tests'
    key: rust-tests
    #parallelism: 2
    commands:
      - '.buildkite/run_retry_dummy.sh'
    timeout_in_minutes: 60
    agents:
      queue: c6a-4xlarge
    retry: *retry_on_agent_kill
