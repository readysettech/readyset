[profile.default]
# Some default exclusions for devs who just want to run `cargo nextest run`. If you want to run all
# tests including these, either use the `ci` profile (--profile ci), or remove the default filter
# (`--ignore-default-filter`).
#
# - `test_large_packet_write` is absurdly long locally even compared to other tests marked slow, and
#   not very valuable unless you're working on related code.
# - Only mysql80 and postgres15 upstream tests run by default. Other upstream versions (mysql57,
#   mysql84, postgres13) are excluded to keep local test runs fast. The `ci` profile runs all of them.
default-filter = 'not test(test_large_packet_write) and not (test(/:mysql\d+:/) and not test(/:mysql80:/)) and not (test(/:postgres\d+:/) and not test(/:postgres15:/))'
slow-timeout = { period = "180s", terminate-after = 1, grace-period = "20s" }

[profile.ci]
default-filter = 'all()'
fail-fast = false
retries = 1
failure-output = "immediate-final"
slow-timeout = { period = "60s", terminate-after = 5, grace-period = "20s" }

[profile.ci.junit]
path = "junit.xml"
store-success-output = true
store-failure-output = true

[test-groups]
serial = { max-threads = 1 }
serial-postgres = { max-threads = 1 }
serial-mysql = { max-threads = 1 }

# Prioritize very_slow tests to run first so they don't become long-pole tests
[[profile.default.overrides]]
filter = 'test(/:very_slow:/)'
priority = 100

[[profile.default.overrides]]
filter = 'test(/:serial:/) and not (test(/:postgres\d+:/) or test(/:mysql\d+:/))'
test-group = 'serial'

[[profile.default.overrides]]
filter = 'test(/:serial:/) and test(/:postgres\d+:/)'
test-group = 'serial-postgres'

[[profile.default.overrides]]
filter = 'test(/:serial:/) and test(/:mysql\d+:/)'
test-group = 'serial-mysql'

[[profile.default.overrides]]
filter = 'test(/:proptest:/)'
retries = 0

# Vertical tests are long-running proptest suites that can take tens of minutes.
# No termination timeout; warn after 45 minutes.
[profile.vertical]
slow-timeout = "2700s"
